<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <title>
    
    Hexo
  </title>
  <!-- Icon -->
  
    <link rel="shortcut icon" href="/favicon.ico">
    
  
<link rel="stylesheet" href="/css/style.css">

  
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <main class="content">
    <section class="jumbotron">
  <div class="video">
    
    <div class="video-frame">
      <img src="/images/ocean/overlay-hero.png" alt="Decorative image frame">
    </div>
    
    <div class="video-media">
      <video playsinline="" autoplay="" loop="" muted="" data-autoplay="" poster="/images/ocean/ocean.png"
        x5-video-player-type="h5">
        <source src="/images/ocean/ocean.mp4" type="video/mp4">
        <source src="/images/ocean/ocean.ogv" type="video/ogg">
        <source src="/images/ocean/ocean.webm" type="video/webm">
        <p>Your user agent does not support the HTML5 Video element.</p>
      </video>
      <div class="video-overlay"></div>
    </div>
    <div class="video-inner text-center text-white">
      <h1><a href="/">Hexo</a></h1>
      <p></p>
      <div><img src="/images/hexo-inverted.svg" class="brand" alt="Hexo"></div>
    </div>
    <div class="video-learn-more">
      <a class="anchor" href="#landingpage"><i class="fe fe-mouse"></i></a>
    </div>
  </div>
</section>
<div id="landingpage">
  <section class="outer">
  <article class="articles">
    
    <h1 class="page-type-title"></h1>
    
    
    <article id="post-è·Ÿæ‰‹åŠ¨ç”»" class="article article-type-post" itemscope
  itemprop="blogPost" data-scroll-reveal>

  <div class="article-inner">
    
    <header class="article-header">
      
  
  <h2 class="article-title" itemprop="name">
    <a href="/2023/03/13/%E8%B7%9F%E6%89%8B%E5%8A%A8%E7%94%BB/">è·Ÿæ‰‹åŠ¨ç”»</a>
  </h2>
  
  

    </header>
    

    
    <div class="article-meta">
      <a href="/2023/03/13/%E8%B7%9F%E6%89%8B%E5%8A%A8%E7%94%BB/" class="article-date">
  <time datetime="2023-03-13T02:32:57.000Z" itemprop="datePublished">2023-03-13</time>
</a>
      
    </div>
    

    

    <div class="article-entry" itemprop="articleBody">
      
      
        
      
      
        <h1 id="è·Ÿæ‰‹åŠ¨ç”»åŸç†"><a href="#è·Ÿæ‰‹åŠ¨ç”»åŸç†" class="headerlink" title="è·Ÿæ‰‹åŠ¨ç”»åŸç†"></a>è·Ÿæ‰‹åŠ¨ç”»åŸç†</h1><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h3 id="1-Intersection-Observer"><a href="#1-Intersection-Observer" class="headerlink" title="1.Intersection Observer"></a>1.Intersection Observer</h3><p><code>Intersection Observer API</code>æä¾›äº†ä¸€ç§<strong>å¼‚æ­¥</strong>æ£€æµ‹ç›®æ ‡å…ƒç´ ä¸ç¥–å…ˆå…ƒç´ æˆ–è§†å£(å¯ç»Ÿç§°ä¸ºæ ¹å…ƒç´ )<strong>ç›¸äº¤æƒ…å†µå˜åŒ–</strong>çš„æ–¹æ³•ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/IntersectionObserver">IntersectionObserveræ¥å£</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7146441070828584968">https://juejin.cn/post/7146441070828584968</a></p>
<p><img src="/2023/03/13/%E8%B7%9F%E6%89%8B%E5%8A%A8%E7%94%BB/Api.png" alt="img"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> target = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.target&quot;</span>)</span><br><span class="line"></span><br><span class="line"> <span class="comment">//IntersectionObserveræ„é€ å™¨çš„callbackå‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">callback</span> = (<span class="params">entries</span>) =&gt;&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(entries[<span class="number">0</span>].<span class="property">intersectionRatio</span>)</span><br><span class="line">  <span class="keyword">if</span> (entries[<span class="number">0</span>].<span class="property">intersectionRatio</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&#x27;#333&#x27;</span>;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="comment">// observer.disconnect()</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">backgroundColor</span> = <span class="string">&#x27;#fff&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//IntersectionObserveræ„é€ å™¨çš„optionå‡½æ•°</span></span><br><span class="line"> <span class="keyword">const</span> option = &#123;</span><br><span class="line">     <span class="attr">root</span>:root <span class="comment">//ç”¨ä½œè¾¹ç•Œçš„è§†å£ï¼Œé»˜è®¤ä¸ºè§†å£</span></span><br><span class="line">     rootMarginï¼š<span class="string">&quot;0px 0px 0px 0px&quot;</span> <span class="comment">//æ”¹å˜è¾¹ç•Œè§†å£çš„æ£€æµ‹èŒƒå›´ï¼Œç±»ä¼¼äºmargin</span></span><br><span class="line">     thresholdï¼š[<span class="number">0</span>,<span class="number">0.1</span>]æˆ–è€…<span class="number">0</span> <span class="comment">//æ•°ç»„æˆ–å…·ä½“å€¼,å½“ç›¸äº¤æ¯”ä¾‹è¶Šè¿‡è¿™äº›å€¼ï¼Œè§¦å‘callbackå‡½æ•°</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//é€šè¿‡IntersectionObserveræ„é€ å™¨æ„é€ ä¸€ä¸ªæ–°çš„IntersectionObserverå¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> observer = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(callback,option)</span><br><span class="line"></span><br><span class="line"> <span class="comment">//è¯¥å¯¹è±¡æ‹¥æœ‰å››ä¸ªæ–¹æ³•</span></span><br><span class="line">observer.<span class="title function_">observe</span>(target)<span class="comment">//ç»‘å®šéœ€è¦æ£€æµ‹çš„å…ƒç´ targetï¼Œå¯ç»‘å®šå¤šä¸ª</span></span><br><span class="line">observer.<span class="title function_">observe</span>(target2)</span><br><span class="line">observer.<span class="title function_">unobserve</span>(target)<span class="comment">//è§£ç»‘å¯¹åº”å…ƒç´ </span></span><br><span class="line">observer.<span class="title function_">takeRecords</span>()<span class="comment">// è¿”å›ç›‘å¬çš„æ•°ç»„</span></span><br><span class="line">observer.<span class="title function_">disconnected</span>()<span class="comment">//è§£é™¤æ‰€æœ‰çš„ç›‘å¬</span></span><br></pre></td></tr></table></figure>

<p>[çº¿ä¸Šdemo]<a target="_blank" rel="noopener" href="https://code.juejin.cn/pen/7206227129149685792">https://code.juejin.cn/pen/7206227129149685792</a></p>
<p><img src="/2023/03/13/%E8%B7%9F%E6%89%8B%E5%8A%A8%E7%94%BB/2.jpg"></p>
<p><code>intersectionRect</code>å±æ€§ï¼Œä¼šè¿”å›targetä¸æ£€æµ‹è§†å£ç›¸äº¤çš„é«˜åº¦ã€‚</p>
<h3 id="2-Emittery"><a href="#2-Emittery" class="headerlink" title="2.Emittery"></a><strong>2.Emittery</strong></h3><h1 id="Emittery-ç®€å•è€Œç°ä»£çš„å¼‚æ­¥äº‹ä»¶å‘å°„å™¨"><a href="#Emittery-ç®€å•è€Œç°ä»£çš„å¼‚æ­¥äº‹ä»¶å‘å°„å™¨" class="headerlink" title="Emittery: ç®€å•è€Œç°ä»£çš„å¼‚æ­¥äº‹ä»¶å‘å°„å™¨"></a><strong>Emittery</strong><strong>: ç®€å•è€Œç°ä»£çš„å¼‚æ­¥äº‹ä»¶å‘å°„å™¨</strong></h1><p>å…³äºå¼‚æ­¥å®ç°çš„åŸç†å’Œä¼˜ç‚¹å¾…è¡¥å……</p>
<p>ä¸<code>EventEmitter</code>ï¼ˆåŒæ­¥å‘å°„å™¨ï¼‰çš„å¼‚åŒç‚¹å¾…è¡¥å……</p>
<p><a target="_blank" rel="noopener" href="https://www.5axxw.com/wiki/content/9kn3ui">Emitteryç®€ä»‹</a></p>
<h4 id="Emitteryå¸¸ç”¨æ–¹æ³•"><a href="#Emitteryå¸¸ç”¨æ–¹æ³•" class="headerlink" title="Emitteryå¸¸ç”¨æ–¹æ³•"></a>Emitteryå¸¸ç”¨æ–¹æ³•</h4><h4 id="on-eventName-eventName-listener-ç»‘å®šç›‘å¬"><a href="#on-eventName-eventName-listener-ç»‘å®šç›‘å¬" class="headerlink" title="on(eventName | eventName[], listener)ç»‘å®šç›‘å¬"></a>on(eventName | eventName[], listener)ç»‘å®šç›‘å¬</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Emittery</span> = <span class="built_in">require</span>(<span class="string">&#x27;emittery&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emitter = <span class="keyword">new</span> <span class="title class_">Emittery</span>();</span><br><span class="line"></span><br><span class="line">emitter.<span class="title function_">on</span>(<span class="string">&#x27;ğŸ¦„&#x27;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// emitterå¯¹è±¡çš„onæ–¹æ³•ï¼ŒeventNameç›‘å¬çš„äº‹ä»¶åï¼Œlistenerå›è°ƒå‡½æ•°</span></span><br><span class="line"></span><br><span class="line">emitter.<span class="title function_">on</span>([<span class="string">&#x27;ğŸ¦„&#x27;</span>, <span class="string">&#x27;ğŸ¶&#x27;</span>], <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">emitter.<span class="title function_">emit</span>(<span class="string">&#x27;ğŸ¦„&#x27;</span>, <span class="string">&#x27;ğŸŒˆ&#x27;</span>); <span class="comment">// è¾“å‡º &#x27;ğŸŒˆ&#x27; x2</span></span><br><span class="line">emitter.<span class="title function_">emit</span>(<span class="string">&#x27;ğŸ¶&#x27;</span>, <span class="string">&#x27;ğŸ–&#x27;</span>); <span class="comment">// è¾“å‡º &#x27;ğŸ–&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="off-eventName-eventName-listener-è§£é™¤ç›‘å¬"><a href="#off-eventName-eventName-listener-è§£é™¤ç›‘å¬" class="headerlink" title="off(eventName | eventName[], listener)è§£é™¤ç›‘å¬"></a>off(eventName | eventName[], listener)è§£é™¤ç›‘å¬</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Emittery</span> = <span class="built_in">require</span>(<span class="string">&#x27;emittery&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emitter = <span class="keyword">new</span> <span class="title class_">Emittery</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">listener</span> = data =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        emitter.<span class="title function_">on</span>([<span class="string">&#x27;ğŸ¦„&#x27;</span>, <span class="string">&#x27;ğŸ¶&#x27;</span>, <span class="string">&#x27;ğŸ¦Š&#x27;</span>], listener);</span><br><span class="line">        <span class="keyword">await</span> emitter.<span class="title function_">emit</span>(<span class="string">&#x27;ğŸ¦„&#x27;</span>, <span class="string">&#x27;a&#x27;</span>); <span class="comment">//è¾“å‡ºa</span></span><br><span class="line">        <span class="keyword">await</span> emitter.<span class="title function_">emit</span>(<span class="string">&#x27;ğŸ¶&#x27;</span>, <span class="string">&#x27;b&#x27;</span>); <span class="comment">//è¾“å‡ºb</span></span><br><span class="line">        <span class="keyword">await</span> emitter.<span class="title function_">emit</span>(<span class="string">&#x27;ğŸ¦Š&#x27;</span>, <span class="string">&#x27;c&#x27;</span>); <span class="comment">//è¾“å‡ºc</span></span><br><span class="line">        emitter.<span class="title function_">off</span>(<span class="string">&#x27;ğŸ¦„&#x27;</span>, listener);</span><br><span class="line">        emitter.<span class="title function_">off</span>([<span class="string">&#x27;ğŸ¶&#x27;</span>, <span class="string">&#x27;ğŸ¦Š&#x27;</span>], listener);</span><br><span class="line">        <span class="keyword">await</span> emitter.<span class="title function_">emit</span>(<span class="string">&#x27;ğŸ¦„&#x27;</span>, <span class="string">&#x27;a&#x27;</span>); <span class="comment">// nothing happens</span></span><br><span class="line">        <span class="keyword">await</span> emitter.<span class="title function_">emit</span>(<span class="string">&#x27;ğŸ¶&#x27;</span>, <span class="string">&#x27;b&#x27;</span>); <span class="comment">// nothing happens</span></span><br><span class="line">        <span class="keyword">await</span> emitter.<span class="title function_">emit</span>(<span class="string">&#x27;ğŸ¦Š&#x27;</span>, <span class="string">&#x27;c&#x27;</span>); <span class="comment">// nothing happens</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h4 id="once-eventName-eventName-then-listener-ç›‘å¬æ‰§è¡Œåè§£é™¤ç›‘å¬"><a href="#once-eventName-eventName-then-listener-ç›‘å¬æ‰§è¡Œåè§£é™¤ç›‘å¬" class="headerlink" title="once(eventName | eventName[]).then(listener)ç›‘å¬æ‰§è¡Œåè§£é™¤ç›‘å¬"></a>once(eventName | eventName[]).then(listener)ç›‘å¬æ‰§è¡Œåè§£é™¤ç›‘å¬</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Emittery</span> = <span class="built_in">require</span>(<span class="string">&#x27;emittery&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> emitter = <span class="keyword">new</span> <span class="title class_">Emittery</span>();</span><br><span class="line"></span><br><span class="line">emitter.<span class="title function_">once</span>(<span class="string">&#x27;ğŸ¦„&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">        <span class="comment">//=&gt; &#x27;ğŸŒˆ&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line">emitter.<span class="title function_">once</span>([<span class="string">&#x27;ğŸ¦„&#x27;</span>, <span class="string">&#x27;ğŸ¶&#x27;</span>]).<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">emitter.<span class="title function_">emit</span>(<span class="string">&#x27;ğŸ¦„&#x27;</span>, <span class="string">&#x27;ğŸŒˆ&#x27;</span>); <span class="comment">// log =&gt; &#x27;ğŸŒˆ&#x27; x2</span></span><br><span class="line">emitter.<span class="title function_">emit</span>(<span class="string">&#x27;ğŸ¶&#x27;</span>, <span class="string">&#x27;ğŸ–&#x27;</span>); <span class="comment">// ç›‘å¬å·²ç»è§¦å‘è¿‡ï¼Œnothing happens</span></span><br><span class="line">emitter.<span class="title function_">emit</span>(<span class="string">&#x27;ğŸ¦„&#x27;</span>, <span class="string">&#x27;ğŸŒˆ&#x27;</span>); <span class="comment">// ç›‘å¬å·²ç»è§¦å‘è¿‡ï¼Œnothing happens</span></span><br></pre></td></tr></table></figure>

<h3 id="3-resize-observer-polyfill"><a href="#3-resize-observer-polyfill" class="headerlink" title="3.resize-observer-polyfill"></a>3.resize-observer-polyfill</h3><p><code>resize-observer-polyfill</code>èƒ½ç«‹å³æ£€æµ‹å…ƒç´ ä½•æ—¶è°ƒæ•´å¤§å°å¹¶å°†å‡†ç¡®çš„å¤§å°ä¿¡æ¯è¿”å›ç»™å›è°ƒå‡½æ•°</p>
<p>ä»“åº“åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/juggle/resize-observer">https://github.com/juggle/resize-observer</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ResizeObserver</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@juggle/resize-observer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ro = <span class="keyword">new</span> <span class="title class_">ResizeObserver</span>(<span class="function">(<span class="params">entries, observer</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="comment">//entrieså¯¹è±¡å±æ€§å¾…è¡¥å……</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Body has resized!&#x27;</span>);</span><br><span class="line">observer.<span class="title function_">disconnect</span>(); <span class="comment">// Stop observing</span></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ro.<span class="title function_">observe</span>(<span class="variable language_">document</span>.<span class="property">body</span>); <span class="comment">// Watch dimension changes on body</span></span><br></pre></td></tr></table></figure>

<h2 id="è·Ÿæ‰‹åŠ¨ç”»å®ç°-Scroom"><a href="#è·Ÿæ‰‹åŠ¨ç”»å®ç°-Scroom" class="headerlink" title="è·Ÿæ‰‹åŠ¨ç”»å®ç°-Scroom"></a>è·Ÿæ‰‹åŠ¨ç”»å®ç°-Scroom</h2><p><a target="_blank" rel="noopener" href="https://github.com/myWsq/scroom">Scroomä»“åº“åœ°å€</a></p>
<h3 id="ä¸»è¦åŸç†ï¼š"><a href="#ä¸»è¦åŸç†ï¼š" class="headerlink" title="ä¸»è¦åŸç†ï¼š"></a>ä¸»è¦åŸç†ï¼š</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// è·Ÿæ‰‹åŠ¨ç”»çš„å®¹å™¨é«˜åº¦ä¸€èˆ¬æ˜¯å¤§äºè§†å£çš„</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrapper&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 3000px&quot;</span>&gt;</span></span><br><span class="line">//æ’­æ”¾åŠ¨ç”»å…ƒç´ é€šè¿‡stickyå¸ƒå±€åœ¨æ»šåŠ¨ä¸­å›ºå®šä½ç½®</span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;player&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">style</span>=<span class="string">&quot;width: 80%; position: sticky; top: 0; margin: 0 auto&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šæ–‡å·²ç»ä»‹ç»<code>intersectionRect</code>å±æ€§ï¼ˆtargetä¸æ£€æµ‹è§†å£ç›¸äº¤çš„é«˜åº¦ï¼‰ï¼Œä½†<code>intersectionRect</code>æœ€å¤§äº¤å‰é«˜åº¦å°äºç›‘æµ‹è§†å£&amp;Targeté«˜åº¦ï¼Œæ»‘åŠ¨å¤„åœ¨ä¸‹å›¾ä½ç½®æ—¶ï¼Œ<code>intersectionRect</code>çš„å€¼å°†å›ºå®šä¸º600pxï¼ˆç›‘æµ‹è§†å£ï¼‰ï¼Œæ­¤æ—¶åŠ¨ç”»çš„è¿›åº¦æ— æ³•è®¡ç®—</p>
<p><img src="/2023/03/13/%E8%B7%9F%E6%89%8B%E5%8A%A8%E7%94%BB/3.jpg"></p>
<p>åˆ©ç”¨<code>rootMargin</code>å±æ€§ï¼Œå°†ç›‘æµ‹è§†å£æ‰©å……åˆ°ä¸Targeté«˜åº¦ä¸€è‡´ï¼Œå°±å¯ä»¥å®ç°æ»šåŠ¨è¿‡ç¨‹<code>intersectionRect</code>å®æ—¶å˜åŒ–ï¼Œèƒ½å¤Ÿå®Œæ•´ç›‘æµ‹æ»šåŠ¨è¿‡ç¨‹.</p>
<p>è®¡ç®—ç›®æ ‡ä¸é»˜è®¤æµè§ˆå™¨è§†å£çš„å·®å€¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const bottomMargin =  target.clientHeight - window.innerHeight;</span><br><span class="line">rootMargin = `0px 0px $&#123;bottomMargin &#125;px 0px`;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/03/13/%E8%B7%9F%E6%89%8B%E5%8A%A8%E7%94%BB/4.jpg"></p>
<p>ç”±äºè·Ÿæ‰‹åŠ¨ç”»è§¦å‘è¦åœ¨å®¹å™¨åˆ’å‡ºç›‘æµ‹è§†å£è§¦å‘ï¼Œç®€å•çš„åˆ¤æ–­æ–¹å¼å°±æ˜¯ï¼Œç›¸äº¤åŒºåŸŸtarget topå°äºtargetå…ƒç´ çš„topï¼Œè¯æ˜targetå·²ç»æœ‰ä¸€éƒ¨åˆ†åˆ’å‡ºç›‘æµ‹è§†å£ã€‚</p>
<p><code>isIntersecting</code> booleanå€¼ä»£è¡¨targetæ˜¯å¦è¿˜åœ¨ç›‘æµ‹è§†å£æœªå®Œå…¨åˆ’å‡º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isProgressing=``boundingClientRect.top &lt; intersectionRect.top`` &amp;&amp; isIntersecting;</span><br></pre></td></tr></table></figure>

<h3 id="å…·ä½“å®ç°"><a href="#å…·ä½“å®ç°" class="headerlink" title="å…·ä½“å®ç°"></a>å…·ä½“å®ç°</h3><p>è°ƒç”¨</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> target = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.wrapper&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sc = <span class="title function_">createScroom</span>(&#123;</span><br><span class="line">    <span class="attr">target</span>: target ,</span><br><span class="line">    <span class="comment">// offsetè°ƒæ•´æ£€æµ‹è§†å£åç§»ï¼Œå½“offsetä¸º1æ—¶ï¼Œprogressåœ¨æµè§ˆå™¨è§†å£åº•éƒ¨è§¦å‘</span></span><br><span class="line">    <span class="comment">//ä¸º0æ—¶ï¼Œprogrssåœ¨æµè§ˆå™¨è§†å£é¡¶éƒ¨è§¦å‘</span></span><br><span class="line">    <span class="attr">offset</span>: <span class="number">0.5</span>,</span><br><span class="line">   &#125;);</span><br><span class="line">   <span class="comment">//ç»‘å®šprogresså¼‚æ­¥è§¦å‘å™¨</span></span><br><span class="line">    sc.<span class="title function_">on</span>(<span class="string">&quot;progress&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒä»£ç </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createScroom</span> (options)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; target, offset = <span class="number">0.5</span>, threshold = <span class="number">4</span>, direction = <span class="string">&#x27;vertical&#x27;</span> &#125; = options;</span><br><span class="line">  <span class="keyword">const</span> emitter = <span class="keyword">new</span> <span class="title class_">Emittery</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// observer for intersecting</span></span><br><span class="line">  <span class="keyword">let</span> intersectionObserver = <span class="title function_">createIntersectionObserver</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// resizeObserver ç”Ÿæˆäº†ä¸€ä¸ªResizeObserverå¯¹è±¡åœ¨targetå°ºå¯¸å˜åŒ–æ—¶è§¦å‘resizeHandler</span></span><br><span class="line">  <span class="keyword">let</span> resizeObserver = <span class="title function_">createResizeObserver</span>();</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">createResizeObserver</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">ResizeObserver</span>(resizeHandler);</span><br><span class="line">    <span class="keyword">return</span> observer;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">resizeHandler</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//æ­¤å›è°ƒå‡½æ•°åœ¨targetå°ºå¯¸å˜åŒ–æ—¶è§¦å‘,é”€æ¯æ‰€æœ‰æ»šåŠ¨ç›‘å¬ï¼Œå¹¶é‡æ–°ç»‘å®š</span></span><br><span class="line">    intersectionObserver.<span class="title function_">disconnect</span>();</span><br><span class="line">    intersectionObserver = <span class="title function_">createIntersectionObserver</span>();</span><br><span class="line">    intersectionObserver.<span class="title function_">observe</span>(target);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">createIntersectionObserver</span>(<span class="params"></span>) &#123;</span><br><span class="line">     .....<span class="comment">//ç”ŸæˆIntersection Observeræ ¸å¿ƒä»£ç ï¼Œä¸‹æ–‡åˆ†æ</span></span><br><span class="line">    <span class="keyword">return</span> observer;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">destroy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    intersectionObserver.<span class="title function_">disconnect</span>();</span><br><span class="line">    resizeObserver.<span class="title function_">disconnect</span>();</span><br><span class="line">    emitter.<span class="title function_">clearListeners</span>();</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeHandler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ©ç”¨ä¸Šæ–‡resize-observer-polyfillç›‘è§†targetå°ºå¯¸å˜åŒ–</span></span><br><span class="line">  resizeObserver.<span class="title function_">observe</span>(target);</span><br><span class="line">    <span class="comment">// ç›‘è§†æµè§ˆå™¨è§†å£çš„å˜åŒ–</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, resizeHandler);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿”å›å¯¹è±¡å¸¦æœ‰çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œå››ä¸ªæ–¹æ³•</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    target,</span><br><span class="line">    <span class="attr">observer</span>: intersectionObserver,</span><br><span class="line">    destroy,</span><br><span class="line">    <span class="attr">on</span>: emitter.<span class="property">on</span>.<span class="title function_">bind</span>(emitter),</span><br><span class="line">    <span class="attr">once</span>: emitter.<span class="property">once</span>.<span class="title function_">bind</span>(emitter),</span><br><span class="line">    <span class="attr">off</span>: emitter.<span class="property">off</span>.<span class="title function_">bind</span>(emitter),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>**<code>IntersectionObserver</code>**å¯¹è±¡ç”Ÿæˆå‡½æ•°</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//const &#123; target, offset = 0.5, threshold = 4, direction = &#x27;vertical&#x27; &#125;éœ€è¦å‚æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createIntersectionObserver</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">rootMargin</span>: string;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">thresholdStep</span>: number;</span><br><span class="line">    <span class="comment">//æ ¹æ®æµè§ˆå™¨è§†å£é«˜åº¦åŠoffsetè°ƒèŠ‚ç›‘æµ‹è§†å£</span></span><br><span class="line">    <span class="keyword">const</span> m1 = -offset * <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">    <span class="keyword">const</span> m2 = (offset - <span class="number">1</span>) * <span class="variable language_">window</span>.<span class="property">innerHeight</span> + target.<span class="property">clientHeight</span>;</span><br><span class="line">    rootMargin = <span class="string">`<span class="subst">$&#123;m1&#125;</span>px 0px <span class="subst">$&#123;m2&#125;</span>px 0px`</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//IntersectionObserverå¯¹è±¡å›è°ƒå‡½æ•°çš„è§¦å‘æ—¶æœºï¼Œ</span></span><br><span class="line">    <span class="comment">//å³thresholdï¼ˆå±æ€§ï¼‰ï¼Œå¯ä»¥ç†è§£ä¸ºæ¯thresholdpxï¼ˆå‚æ•°ï¼‰è§¦å‘ä¸€æ¬¡ï¼Œï¼ˆå‘½åé‡å¤ï¼‰</span></span><br><span class="line">    thresholdStep = threshold / target.<span class="property">clientHeight</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> isIntersectingLastTick = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> progressLastTick = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> isFirstEnter = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      isFirstEnter = <span class="literal">false</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">IntersectionObserver</span>(</span><br><span class="line">      <span class="function">(<span class="params">[entry]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// boundingClientRect</span></span><br><span class="line">        <span class="keyword">const</span> &#123; </span><br><span class="line">        <span class="comment">//targetç»‘å®šå…ƒç´ çš„å°ºå¯¸å¯¹è±¡</span></span><br><span class="line">        <span class="attr">boundingClientRect</span>: client, </span><br><span class="line">        <span class="comment">//targetç»‘å®šå…ƒç´ ä¸æµè§ˆå™¨ç›¸äº¤çš„å°ºå¯¸å¯¹è±¡</span></span><br><span class="line">        <span class="attr">intersectionRect</span>: rect, </span><br><span class="line">        <span class="comment">//å…ƒç´ æ˜¯å¦åœ¨ç›‘æµ‹è§†å£</span></span><br><span class="line">        isIntersecting &#125; = entry;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> isProgressing = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">let</span> progress = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“æ£€æµ‹çš„å…ƒç´ ä¸Šè¾¹ç•Œå®Œå…¨åˆ’è¿‡è§†å£ &amp;&amp; å…ƒç´ æœªå®Œå…¨æ¶ˆå¤±isProgressing=true</span></span><br><span class="line">        <span class="comment">//client.top &lt; rect.topä¿è¯äº†å®¹å™¨åœ¨åˆ’å‡ºè§†å£æ—¶è¿›å…¥Progressing</span></span><br><span class="line">        isProgressing = client.<span class="property">top</span> &lt; rect.<span class="property">top</span> &amp;&amp; isIntersecting;</span><br><span class="line">        <span class="comment">// æ ¹æ®ç›¸äº¤é«˜åº¦åŠå…ƒç´ æ€»é«˜åº¦è®¡ç®—è¿›åº¦</span></span><br><span class="line">        progress = <span class="number">1</span> - rect.<span class="property">height</span> / client.<span class="property">height</span>;</span><br><span class="line"></span><br><span class="line">        isIntersectingLastTick = isProgressing;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">emitProgress</span> = (<span class="params">progress</span>) =&gt; &#123;</span><br><span class="line">          <span class="keyword">if</span> (progressLastTick !== progress) &#123;</span><br><span class="line">          <span class="comment">//å¼‚æ­¥è§¦å‘å™¨çš„è§¦å‘ï¼Œéœ€è¦åœ¨è°ƒç”¨å¤„.onç»‘å®šprogressè§¦å‘å™¨</span></span><br><span class="line">            emitter.<span class="title function_">emit</span>(<span class="string">&#x27;progress&#x27;</span>, &#123;</span><br><span class="line">              target,</span><br><span class="line">              progress,</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">          progressLastTick = progress;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isProgressing &amp;&amp; progressLastTick !== progress) &#123;</span><br><span class="line">          <span class="title function_">emitProgress</span>(progress);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        rootMargin,</span><br><span class="line">        <span class="attr">threshold</span>: <span class="title function_">genRange</span>(<span class="number">0</span>, <span class="number">1</span>, thresholdStep),</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> observer;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/13/%E8%B7%9F%E6%89%8B%E5%8A%A8%E7%94%BB/" data-id="clf6hpgs60000h0rjcotaajq1" class="article-share-link">
        Share
      </a>
      
    </footer>

  </div>

  

  

</article>
    
  </article>
  

  
</section>
</div>
    <footer class="footer">
  <div class="outer">
    <ul class="list-inline">
      <li>Hexo &copy; 2023</li>
      
        <li>
          
            <a href="https://beian.miit.gov.cn/" target="_blank"></a>
            
        </li>
      
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
    <p><ul class="list-inline">
  
  <li><i class="fe fe-bar-chart tooltip" data-tooltip="PV"></i> <span id="busuanzi_value_site_pv"></span></li>
  
  <li><i class="fe fe-smile-alt tooltip" data-tooltip="UV"></i> <span id="busuanzi_value_site_uv"></span></li>
  
</ul></p>
  </div>
</footer>
  </main>
  <aside class="sidebar">
    <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/hexo.svg" alt="Hexo"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">Home</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">Archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/gallery">Gallery</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">About</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="fe fe-feed"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
  </aside>
  
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>



<script src="/fancybox/jquery.fancybox.min.js"></script>






<script src="/js/ocean.js"></script>

</body>

</html>